<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="layout" inherit_id="website.layout" name="Forum Layout" primary="True">
        <xpath expr="//div[@id='wrapwrap']" position="before">
            <t t-set="pageName" t-value="'website_discussion_forum'"/>
        </xpath>
        <xpath expr="//div[@id='wrapwrap']" position="attributes">
            <attribute name="t-att-data-forum_id">forum and forum.id</attribute>
        </xpath>
    </template>

    <template id="discussion_forum_all" name="Discussion Forum">
        <t t-call="website.layout">
            <t t-set="pageName" t-value="'website_discussion_forum'"/>
            <div id="wrap">
                <div class="container">
                    <table class="table forum_display_layout_cl table-striped table-bordered mt32" t-if="forums">
                        <thead>
                        <tr>
                          <th>Forum Name</th>
                          <th>Posts</th>
                          <th>Reply</th>
                          <th>Post views</th>
                        </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="forums" t-as="forum">
                              <td><a t-attf-href="/discussion/forum/#{slug(forum)}"><t t-esc="forum.name"/></a></td>
                              <td><t t-esc="forum.post_count"/></td>
                              <td><t t-esc="forum.post_reply_counts"/></td>
                              <td><t t-esc="forum.post_total_views_counts"/></td>
                            </tr>
                        </tbody>
                    </table>
                    <t t-if="not forums">
                        <h2 class="mt64 text-center">Not Found any Forums</h2>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <template id="discussion_forum_page" name="Forum">
        <t t-call="bluemax_forum.layout">
            <t t-if="forum and not forum.active">
                <t t-set="head">
                    <meta name="robots" content="noindex, nofollow" />
                </t>
            </t>
            <t t-set="pageName" t-value="'website_discussion_forum_page'"/>
            <div id="wrap">
                <div class="container">
                    <nav id="o_wforum_nav" aria-label="breadcrumb" class="navbar d-flex gap-2  px-0">
                        <div class="o_wforum_breadcrumb_root_list_or_edit d-flex">
                            <div class="col-10 col-lg flex-grow-1 fs-5">
                                <span class="fw-bold mb-0"><t t-esc="forum.name"/></span>
                            </div>
                        </div>
                        <div class="d-flex justify-content-lg-end gap-2 flex-grow-1 flex-wrap flex-md-nowrap w-100 w-lg-auto mw-xl-50" t-if="not user._is_public()">
                                <a role="button" type="button" class="o_wforum_ask_btn btn btn-primary w-100 w-md-auto " 
                                    t-attf-href="/discussion/forum/#{slug(forum)}/ask">
                                    New Post
                                </a>
                        </div>
                    </nav>
                    <table class="table forum_display_layout_cl table-striped table-bordered mt32" t-if="question_ids">
                        <thead>
                        <tr>
                          <th>Subject</th>
                          <th>Opened By</th>
                          <th>Last Post</th>
                          <th>Reply</th>
                          <th>Viewed</th>
                        </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="question_ids" t-as="question_id">
                              <td><a t-attf-href="/discussion/forum/#{slug(forum)}/#{slug(question_id)}"><t t-esc="question_id.name"/></a></td>
                              <td>
                                  <div class="d-flex flex-column small">
                                    <a href="#">
                                        <t t-esc="question_id.create_uid.sudo().name"/>
                                    </a>
                                   </div>
                                   <t t-if="website.get_user_rank_logs(question_id.create_uid.sudo()) and not question_id.create_uid.sudo().has_group('bluemax_forum.group_moderator')">
                                     <img t-att-src="website.get_user_rank_logs(question_id.create_uid.sudo())" style="max-height:22px;"/>
                                   </t>
                                   <t t-if="question_id.create_uid.sudo().has_group('bluemax_forum.group_moderator')">
                                     <img src="/bluemax_forum/static/src/img/power.gif" style="max-height:22px;"/>
                                   </t>
                              </td>
                              <td>
                                  <div class="d-flex flex-column small">
                                     <span>Last reply by <t t-esc="question_id.last_reply_uid.sudo().name"/> on</span>
                                     <span>
                                        <span t-field="question_id.last_activity_date" t-options='{"format": "MMMM d, Y"}'></span>
                                        at
                                        <span t-field="question_id.last_activity_date" t-options='{"format": "h:mm:ss a"}'></span>
                                        <a title="Click here to go to the last post 
I agree. The article is about midget racing and how the numbers don't really pan out for it to work well. It goes " t-attf-href="/discussion/forum/#{slug(forum)}/#{slug(question_id)}/last/post">
<img src="/bluemax_forum/static/src/img/lastPost.gif" border="0"/></a>
                                    </span>
                                  </div>
                              </td>
                              <td><t t-esc="len(question_id.child_ids)"/></td>
                              <td><t t-esc="question_id.views"/></td>
                            </tr>
                        </tbody>
                    </table>
                    <t t-if="forum and not question_ids">
                        <h2 class="mt64 text-center">Not post in this <t t-esc="forum.name"/></h2>
                    </t>
                    <div class="d-flex justify-content-center mt32 mb32">
                        <t t-call="website.pager"/>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="new_question" name="New Post">
        <t t-call="bluemax_forum.layout">
            <div id="wrap">
                <div class="container">
                    <div class="col-md-8 offset-md-2">
                        <nav id="o_wforum_nav" aria-label="breadcrumb" class="navbar d-flex gap-2 justify-content-center px-0">
                            <div class="o_wforum_breadcrumb_root_list_or_edit d-flex">
                                <div class="col-10 col-lg flex-grow-1 fs-5">
                                    <span class="fw-bold mb-0"><t t-esc="forum.name"/></span>
                                </div>
                            </div>
                        </nav>
                        <form t-attf-action="/discussion/forum/#{slug(forum)}/new" method="post" role="form" class="tag_text js_website_submit_form js_wforum_submit_form o_wforum_readable mt-lg-3">
                            <div class="row mb-3">
                                <label class="form-label col-lg-2" for="content">Title</label>
                                <div class="col">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <input type="text" name="post_name" required="required" pattern=".*\S.*" t-att-value="post_name"
                                        class="form-control" placeholder="Write a clear, explicit and concise title" title="Title must not be empty"/>
    
                                </div>
                            </div>
                            <div class="row mb-3">
                                <label class="form-label col-lg-2" for="content">Description</label>
                                <div class="col">
                                    <textarea name="content" required="required" id="content" class="form-control o_wysiwyg_loader">
                                        <t t-out="question_content"/>
                                    </textarea>
                                </div>
                            </div>
                            <div class="row mb-5">
                                <div class="col offset-lg-2">
                                    <button type="submit" t-attf-class="o_wforum_submit_post btn btn-primary">Post Message</button>
                                    <a class="btn btn-link" title="Back to Question" t-attf-href="/discussion/forum/#{ slug(forum) }">Discard</a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </t>
    </template>
    <template id="post_description_full" name="New Post">
        <t t-call="bluemax_forum.layout">
            <div id="wrap">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <table class="table forum_display_layout_cl table-striped table-bordered mt32" style="border: 2px solid blue;">
                                <tbody>
                                    <tr bgcolor="blue">
                                        <td valign="middle" style="color:#FFFFFF" colspan="3">
                                            <b>
                                                Topic: <t t-esc="question.name"/>
                                            </b>
                                        </td>                
                                    </tr>
                                    <tr>
                                        <td colspan="3" align="center" bgcolor="white">
                                            <b>
                                                <i>
                                                    Page <t t-esc="page"/> of <t t-esc="total_pages"/> &amp;nbsp;&amp;nbsp;of&amp;nbsp;&amp;nbsp;<t t-esc="total_posts"/> replies
                                                </i>
                                            </b>
                                        </td>
                                    </tr>
                                    <tr valign="top" bgcolor="#cccc99" t-if="page == 1" t-attf-id="post_message_#{question.id}">
                                        <td>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                       <t t-set="base64_image" t-value="question.create_uid.sudo().image_128 and question.create_uid.sudo().image_128.decode('utf-8') or False"/>
                                                        <td t-if="base64_image">
                                                            <img t-att-src="'data:image/png;base64,' + base64_image" border="0"/>
                                                        </td>
                                                       <td align="left" valign="top">
                                                          <table border="0" cellpadding="0" cellspacing="5">
                                                             <tbody>
                                                                <tr>
                                                                   <td colspan="2">
                                                                      <a href="#">
                                                                          <t t-esc="question.create_uid.sudo().name"/>
                                                                      </a>
                                                                   </td>
                                                                </tr>
                                                                <tr>
                                                                </tr>
                                                             </tbody>
                                                          </table>
                                                       </td>
                                                    </tr>
                                                    <tr>
                                                       <td colspan="2">
                                                          <div class="small">
                                                              <span t-field="question.create_date" t-options='{"format": "MMMM d, Y"}'></span>
                                                                at
                                                                <span t-field="question.create_date" t-options='{"format": "h:mm:ss a"}'></span>
                                                          </div> 
                                                       </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                       <td>
                                          <table border="0">
                                             <tbody>
                                                <tr>
                                                   <td>
                                                      Joined:
                                                   </td>
                                                   <td align="left">
                                                      <span t-field="question.create_uid.sudo().create_date" t-options='{"format": "MM/dd/YYYY"}'/>
                                                      
                                                   </td>
                                                </tr>
                                                <tr>
                                                   <td>
                                                      Posts:
                                                   </td>
                                                   <td align="left">
                                                      <t t-esc="question.create_uid.sudo().user_post_count"/>
                                                   </td>
                                                </tr>
                                             </tbody>
                                          </table>
                                       </td>
                                       <td>
                                          <table align="center">
                                             <tbody>
                                                <tr>
                                                   <td>
                                                      <a href="#" class="reply_post_msg" t-att-data-partner_id="question.create_uid.sudo().partner_id.id" t-att-data-user_id="question.create_uid.sudo().id" t-att-data-question_post_id="question.id" t-att-data-reply_post_id="question.id" t-if="question.state != 'close'">Reply</a>
                                                      <t t-if="question.state != 'close' and user.has_group('bluemax_forum.group_moderator')">
                                                        |
                                                          <a href="#" class="anchor_post_msg_cl" t-att-data-question_post_id="question.id">Anchor</a>
                                                      </t>
                                                      <t t-if="question.state != 'close' and user.has_group('bluemax_forum.group_moderator')">
                                                          |
                                                          <a href="#" class="edit_post_msg_cl" t-att-data-question_post_id="question.id">Edit</a>
                                                      </t>
                                                      <t t-if="question.state == 'active' and user.has_group('bluemax_forum.group_moderator')">
                                                      |
                                                        <a t-attf-href="/discussion/forum/#{slug(forum)}/question/#{slug(question)}/close" class="close_post_msg_cl" t-if="question.state == 'active'">Close Thread</a>
                                                      </t>
                                                      <t t-if="question.state == 'close' and user.has_group('bluemax_forum.group_moderator')">
                                                      |
                                                          <a t-attf-href="/discussion/forum/#{slug(forum)}/question/#{slug(question)}/reopen" class="close_post_msg_cl" t-if="question.state == 'close'">Reopen Thread</a>
                                                      </t>
                                                      <t t-if="user.has_group('bluemax_forum.group_moderator')">
                                                          |
                                                          <a t-attf-href="/discussion/forum/#{slug(forum)}/question/#{slug(question)}/delete" title="Verify Delete" onclick="return confirm('Are you sure you want to delete this post?')">Delete Post</a>
                                                      </t>
                                                      <t t-if="user.has_group('bluemax_forum.group_moderator')">
                                                        |
                                                         <a t-attf-href="/discussion/forum/#{slug(forum)}/question/#{slug(question)}/delete_posts_and_ban_user" title="Verify Delete" onclick="return confirm('Are you sure you want to delete all Posts and Ban the user? It cannot be recovered!');">Delete All Posts and Ban User</a>
                                                      </t>
                                                   </td>
                                                </tr>
                                             </tbody>
                                          </table>
                                       </td>
                                    </tr>
                                    <tr valign="top" bgcolor="#cccc99" t-if="page == 1">
                                       <td colspan="3" style="border-bottom:8px solid blue;">
                                          <div class="main_thread_containt" t-attf-qpost_id="question_post_#{question.id}">
                                              <t t-out="question.content"/>
                                          </div>
                                          <br/>
                                       </td>
                                    </tr>
                                    <t t-if="childs_post_ids">
                                        <t t-foreach="childs_post_ids" t-as="child_post">
                                            <tr valign="middle" bgcolor="#F4F4FF" t-attf-id="post_message_#{child_post.id}">
                                               <td>
                                                  <table>
                                                     <tbody>
                                                        <tr>
                                                           <t t-set="base64_image" t-value="child_post.create_uid.sudo().image_128 and child_post.create_uid.sudo().image_128.decode('utf-8') or False"/>
                                                            <td t-if="base64_image">
                                                                <img t-att-src="'data:image/png;base64,' + base64_image" border="0"/>
                                                            </td>
                                                           <td align="left" valign="top">
                                                              <table border="0" cellpadding="0" cellspacing="5">
                                                                 <tbody>
                                                                    <tr>
                                                                       <td colspan="2">
                                                                          <a href="#">
                                                                              <t t-esc="child_post.create_uid.sudo().name"/>
                                                                          </a>
                                                                       </td>
                                                                    </tr>
                                                                    <tr>
                                                                    </tr>
                                                                 </tbody>
                                                              </table>
                                                           </td>
                                                        </tr>
                                                        <tr>
                                                           <td colspan="2">
                                                              <div class="small">
                                                                  <span t-field="child_post.create_date" t-options='{"format": "MMMM d, Y"}'></span>
                                                                    at
                                                                    <span t-field="child_post.create_date" t-options='{"format": "h:mm:ss a"}'></span>
                                                              </div>  
                                                           </td>
                                                        </tr>
                                                     </tbody>
                                                  </table>
                                               </td>
                                               <td>
                                                  <table border="0">
                                                     <tbody>
                                                        <tr>
                                                           <td>
                                                              Joined:
                                                           </td>
                                                           <td align="left">
                                                              <span t-field="child_post.create_uid.sudo().create_date" t-options='{"format": "MM/dd/YYYY"}'/>
                                                           </td>
                                                        </tr>
                                                        <tr>
                                                           <td>
                                                              Posts:
                                                           </td>
                                                           <td align="left">
                                                              <t t-esc="child_post.create_uid.sudo().user_post_count"/>
                                                           </td>
                                                        </tr>
                                                     </tbody>
                                                  </table>
                                               </td>
                                               <td>
                                                  <table align="center">
                                                     <tbody>
                                                        <tr>
                                                           <td>

                                                              <a href="#" class="reply_post_msg" t-att-data-partner_id="child_post.create_uid.sudo().partner_id.id" t-att-data-user_id="child_post.create_uid.sudo().id" t-att-data-question_post_id="question.id" t-att-data-reply_post_id="child_post.id" t-if="question.state != 'close'">Reply</a>
                                                            <t t-if="user.has_group('bluemax_forum.group_moderator') or child_post.create_uid.sudo().id == user.id">
                                                              |
                                                                <a href="#" class="edit_post_msg_cl" t-att-data-question_post_id="child_post.id">Edit</a>
                                                            </t>
                                                            <t t-if="user.has_group('bluemax_forum.group_moderator')">
                                                              | <a t-attf-href="/discussion/forum/#{slug(forum)}/question/#{slug(child_post)}/delete" onclick="return confirm('Are you sure you want to delete this post?')">Delete Post</a>
                                                             </t>
                                                           </td>
                                                        </tr>
                                                     </tbody>
                                                  </table>
                                               </td>
                                            </tr>
                                            <tr valign="middle" bgcolor="#F4F4FF">
                                               <td colspan="3" style="border-bottom:8px solid blue;">
                                                     <t t-if="child_post.reply_parent_id">
                                                          Reply to:<br/>
                                                          <table border="1" bgcolor="#FFFF66">
                                                             <tbody>
                                                                <tr>
                                                                   <td>
                                                                     <div class="small">
                                                                      Posted By : <t t-esc="child_post.reply_parent_id.create_uid.sudo().name"/>
                                                                       <span t-field="child_post.reply_parent_id.sudo().create_date" t-options='{"format": "MMMM d Y"}'></span>
                                                                        at
                                                                        <span t-field="child_post.reply_parent_id.sudo().create_date" t-options='{"format": "h:mm:ss a"}'></span>
                                                                       </div>
                                                                        <br/>
                                                                      <t t-out="child_post.reply_parent_id.content"/>
                                                                   </td>
                                                                </tr>
                                                             </tbody>
                                                          </table>
                                                      <br/><br/>
                                                   </t>
                                                  <div class="main_thread_containt" t-attf-qpost_id="question_post_#{child_post.id}">
                                                      <t t-out="child_post.content"/>
                                                  </div>
                                                  <br/>
                                                  <br/>
                                               </td>
                                            </tr>
                                        </t>
                                    </t>
                                </tbody>
                            </table>
                            <t t-call="website.pager"/>

                            <br/>
                            <button class="btn btn-primary reply_post_msg" t-att-data-partner_id="question.create_uid.sudo().partner_id.id" t-att-data-user_id="question.create_uid.sudo().id" t-att-data-question_post_id="question.id" t-if="not user._is_public() and question.state != 'close'">
                               Post Message   
                            </button>
                            <br/>
                            <br/>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="post_answer_msg">
        <div class="d-flex align-items-center mb-3">
            <div class="d-flex align-items-center">
                <img t-if="user" t-attf-class="o_wforum_avatar me-2 rounded-circle" t-att-src="request.website.image_url(user, 'avatar_128', '24x24')" alt="Avatar"/>
                <h4 class="my-0">Post Message</h4>
            </div>
        </div>
            <form t-att-action="action_url" method="post" class="js_website_submit_form js_wforum_submit_form d-flex flex-column" role="form" t-if="question">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <t t-if="reply_post_id">
                <input type="hidden" name="reply_parent_id" t-att-value="reply_post_id"/>
            </t>
            <div class="o_wysiwyg_textarea_wrapper">
                <textarea name="content" t-attf-id="content-#{str(question.id)}" class="form-control o_wysiwyg_loader" required="required" minlength="50"/>
            </div>
            <div>
                <button type="submit" t-attf-class="o_wforum_submit_post btn btn-primary my-3">Post Answer</button>
                <a href="#"
                   class="o_wforum_discard_btn btn btn-link"
                >Discard</a>
            </div>
        </form>
    </template>

    <template id="post_answer">
        <div class="d-flex align-items-center mb-3">
            <div class="d-flex align-items-center">
                <img t-if="user" t-attf-class="o_wforum_avatar me-2 rounded-circle" t-att-src="request.website.image_url(user, 'avatar_128', '24x24')" alt="Avatar"/>
                <h4 class="my-0">Post Reply</h4>
            </div>
        </div>
            <form t-att-action="action_url" method="post" class="js_website_submit_form js_wforum_submit_form d-flex flex-column" role="form" t-if="question">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <t t-if="reply_post_id">
                <input type="hidden" name="reply_parent_id" t-att-value="reply_post_id"/>
            </t>
            <div class="o_wysiwyg_textarea_wrapper">
                <textarea name="content" t-attf-id="content-#{str(question.id)}" class="form-control o_wysiwyg_loader" required="required" minlength="50"/>
            </div>
            <div>
                <button type="submit" t-attf-class="o_wforum_submit_post btn btn-primary my-3">Post Answer</button>
                <a href="#"
                   class="o_wforum_discard_btn btn btn-link"
                >Discard</a>
            </div>
        </form>
    </template>

    <template id="edit_post_answer">
        <div class="d-flex align-items-center mb-3">
            <div class="d-flex align-items-center">
                <img t-if="user" t-attf-class="o_wforum_avatar me-2 rounded-circle" t-att-src="request.website.image_url(user, 'avatar_128', '24x24')" alt="Avatar"/>
                <h4 class="my-0">Edit Post</h4>
            </div>
        </div>
        <form t-att-action="action_url" method="post" role="form" class="js_website_submit_form js_wforum_submit_form d-flex flex-column">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <div class="row mb-3" t-if="not question.parent_id">
                <label class="form-label col-lg-2" for="content">Title</label>
                <div class="col">
                    <input type="text" name="post_name" required="required" pattern=".*\S.*" t-att-value="post_name"
                        class="form-control" placeholder="Write a clear, explicit and concise title" title="Title must not be empty"/>

                </div>
            </div>
            <div class="row mb-3">
                <label class="form-label col-lg-2" for="content">Description</label>
                <div class="col">
                    <div class="o_wysiwyg_textarea_wrapper">
                        <textarea name="content" required="required" id="content" class="form-control o_wysiwyg_loader">
                            <t t-out="question.content"/>
                        </textarea>
                    </div>
                </div>
            </div>
            <div class="row mb-5">
                <div class="col offset-lg-2">
                    <button type="submit" t-attf-class="o_wforum_submit_post btn btn-primary">Edit Message</button>
                    <a href="#"
                       class="o_wforum_discard_btn btn btn-link"
                    >Discard</a>
                </div>
            </div>
        </form>
    </template>

    <template id="reply_post_popup_main" name="Reply Post">
        <div id="reply_post_popup_main" class="position-fixed d-flex flex-column start-0 end-0 bottom-0 w-100 w-lg-50 shadow mx-auto px-3 bg-body">
            <t t-if="not is_edit_post_open">
                <t t-if="reply_post_id">
                    <div t-call="bluemax_forum.post_answer" class="container my-3"/>
                </t>
                <t t-else="">
                    <div t-call="bluemax_forum.post_answer_msg" class="container my-3"/>
                </t>
            </t>
            <t t-if="is_edit_post_open">
                <div t-call="bluemax_forum.edit_post_answer" class="container my-3"/>
            </t>
        </div>
    </template>

</odoo>
